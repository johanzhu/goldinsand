function plane(t,e){return function(r,i){var n=(r-.5)*t,a=(i+.5)*e;return new THREE.Vector3(n,a,0)}}function Particle(t,e,r,i){this.position=clothFunction(t,e),this.previous=clothFunction(t,e),this.original=clothFunction(t,e),this.a=new THREE.Vector3(0,0,0),this.mass=i,this.invMass=1/i,this.tmp=new THREE.Vector3,this.tmp2=new THREE.Vector3}function satisifyConstrains(t,e,r){diff.subVectors(e.position,t.position);var i=diff.length();if(0!=i){var n=diff.multiplyScalar(1-r/i).multiplyScalar(.5);t.position.add(n),e.position.sub(n)}}function Cloth(t,e){function r(e,r){return e+r*(t+1)}t=t||10,e=e||10,this.w=t,this.h=e;var i,n,a=[],o=[];for(n=0;n<=e;n++)for(i=0;i<=t;i++)a.push(new Particle(i/t,n/e,0,MASS));for(n=0;n<e;n++)for(i=0;i<t;i++)o.push([a[r(i,n)],a[r(i,n+1)],restDistance]),o.push([a[r(i,n)],a[r(i+1,n)],restDistance]);for(i=t,n=0;n<e;n++)o.push([a[r(i,n)],a[r(i,n+1)],restDistance]);for(n=e,i=0;i<t;i++)o.push([a[r(i,n)],a[r(i+1,n)],restDistance]);this.particles=a,this.constrains=o,this.index=r}function simulate(t){if(lastTime){var e,r,i,n,a,o;if(wind){var s,u,c=clothGeometry.faces;for(i=cloth.particles,e=0,r=c.length;e<r;e++)u=(s=c[e]).normal,tmpForce.copy(u).normalize().multiplyScalar(u.dot(windForce)),i[s.a].addForce(tmpForce),i[s.b].addForce(tmpForce),i[s.c].addForce(tmpForce)}for(e=0,r=(i=cloth.particles).length;e<r;e++)(n=i[e]).addForce(gravity),n.integrate(TIMESTEP_SQ);for(r=(a=cloth.constrains).length,e=0;e<r;e++)satisifyConstrains((o=a[e])[0],o[1],o[2]);for(e=0,r=(i=cloth.particles).length;e<r;e++)n=i[e],pos=n.position,pos.y<-250&&(pos.y=-250);for(e=0,r=pins.length;e<r;e++){var l=i[pins[e]];l.position.copy(l.original),l.previous.copy(l.original)}}else lastTime=t}var DAMPING=.03,DRAG=1-DAMPING,MASS=.1,restDistance=25,xSegs=5,ySegs=5,clothFunction=plane(1.2*xSegs,5*ySegs),cloth=new Cloth(xSegs,ySegs),GRAVITY=981*1.4,gravity=new THREE.Vector3(0,-GRAVITY,0).multiplyScalar(MASS),TIMESTEP=.018,TIMESTEP_SQ=TIMESTEP*TIMESTEP,pins=[],wind=!0,windStrength=2,windForce=new THREE.Vector3(0,0,0),tmpForce=new THREE.Vector3,lastTime;Particle.prototype.addForce=function(t){this.a.add(this.tmp2.copy(t).multiplyScalar(this.invMass))},Particle.prototype.integrate=function(t){var e=this.tmp.subVectors(this.position,this.previous);e.multiplyScalar(DRAG).add(this.position),e.add(this.a.multiplyScalar(t)),this.tmp=this.previous,this.previous=this.position,this.position=e,this.a.set(0,0,0)};var diff=new THREE.Vector3;THREE.JSONLoader=function(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.withCredentials=!1},THREE.JSONLoader.prototype={constructor:THREE.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(t,e,r,i){var n=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(t),o=new THREE.XHRLoader(this.manager);o.setWithCredentials(this.withCredentials),o.load(t,function(r){var i=JSON.parse(r),o=i.metadata;if(void 0!==o){var s=o.type;if(void 0!==s){if("object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.")}}var u=n.parse(i,a);e(u.geometry,u.materials)},r,i)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){var r=new THREE.Geometry,i=void 0!==t.scale?1/t.scale:1;if(function(e){function i(t,e){return t&1<<e}var n,a,o,s,u,c,l,h,p,d,f,g,m,E,v,y,T,A,S,x,_,b,P,C,R,O,w,I=t.faces,L=t.vertices,M=t.normals,H=t.colors,N=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&N++;for(n=0;n<N;n++)r.faceVertexUvs[n]=[]}for(s=0,u=L.length;s<u;)(A=new THREE.Vector3).x=L[s++]*e,A.y=L[s++]*e,A.z=L[s++]*e,r.vertices.push(A);for(s=0,u=I.length;s<u;)if(d=I[s++],f=i(d,0),g=i(d,1),m=i(d,3),E=i(d,4),v=i(d,5),y=i(d,6),T=i(d,7),f){if(x=new THREE.Face3,x.a=I[s],x.b=I[s+1],x.c=I[s+3],_=new THREE.Face3,_.a=I[s+1],_.b=I[s+2],_.c=I[s+3],s+=4,g&&(p=I[s++],x.materialIndex=p,_.materialIndex=p),o=r.faces.length,m)for(n=0;n<N;n++)for(C=t.uvs[n],r.faceVertexUvs[n][o]=[],r.faceVertexUvs[n][o+1]=[],a=0;a<4;a++)O=C[2*(h=I[s++])],w=C[2*h+1],R=new THREE.Vector2(O,w),2!==a&&r.faceVertexUvs[n][o].push(R),0!==a&&r.faceVertexUvs[n][o+1].push(R);if(E&&(l=3*I[s++],x.normal.set(M[l++],M[l++],M[l]),_.normal.copy(x.normal)),v)for(n=0;n<4;n++)l=3*I[s++],P=new THREE.Vector3(M[l++],M[l++],M[l]),2!==n&&x.vertexNormals.push(P),0!==n&&_.vertexNormals.push(P);if(y&&(b=H[c=I[s++]],x.color.setHex(b),_.color.setHex(b)),T)for(n=0;n<4;n++)b=H[c=I[s++]],2!==n&&x.vertexColors.push(new THREE.Color(b)),0!==n&&_.vertexColors.push(new THREE.Color(b));r.faces.push(x),r.faces.push(_)}else{if(S=new THREE.Face3,S.a=I[s++],S.b=I[s++],S.c=I[s++],g&&(p=I[s++],S.materialIndex=p),o=r.faces.length,m)for(n=0;n<N;n++)for(C=t.uvs[n],r.faceVertexUvs[n][o]=[],a=0;a<3;a++)O=C[2*(h=I[s++])],w=C[2*h+1],R=new THREE.Vector2(O,w),r.faceVertexUvs[n][o].push(R);if(E&&(l=3*I[s++],S.normal.set(M[l++],M[l++],M[l])),v)for(n=0;n<3;n++)l=3*I[s++],P=new THREE.Vector3(M[l++],M[l++],M[l]),S.vertexNormals.push(P);if(y&&(c=I[s++],S.color.setHex(H[c])),T)for(n=0;n<3;n++)c=I[s++],S.vertexColors.push(new THREE.Color(H[c]));r.faces.push(S)}}(i),function(){var e=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var i=0,n=t.skinWeights.length;i<n;i+=e){var a=t.skinWeights[i],o=e>1?t.skinWeights[i+1]:0,s=e>2?t.skinWeights[i+2]:0,u=e>3?t.skinWeights[i+3]:0;r.skinWeights.push(new THREE.Vector4(a,o,s,u))}if(t.skinIndices)for(var i=0,n=t.skinIndices.length;i<n;i+=e){var c=t.skinIndices[i],l=e>1?t.skinIndices[i+1]:0,h=e>2?t.skinIndices[i+2]:0,p=e>3?t.skinIndices[i+3]:0;r.skinIndices.push(new THREE.Vector4(c,l,h,p))}r.bones=t.bones,r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}(),function(e){if(void 0!==t.morphTargets)for(var i=0,n=t.morphTargets.length;i<n;i++){r.morphTargets[i]={},r.morphTargets[i].name=t.morphTargets[i].name,r.morphTargets[i].vertices=[];for(var a=r.morphTargets[i].vertices,o=t.morphTargets[i].vertices,s=0,u=o.length;s<u;s+=3){var c=new THREE.Vector3;c.x=o[s]*e,c.y=o[s+1]*e,c.z=o[s+2]*e,a.push(c)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var l=r.faces,h=t.morphColors[0].colors,i=0,n=l.length;i<n;i++)l[i].color.fromArray(h,3*i)}}(i),function(){var e=[],i=[];void 0!==t.animation&&i.push(t.animation),void 0!==t.animations&&(t.animations.length?i=i.concat(t.animations):i.push(t.animations));for(var n=0;n<i.length;n++){var a=THREE.AnimationClip.parseAnimation(i[n],r.bones);a&&e.push(a)}if(r.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(r.morphTargets,10);e=e.concat(o)}e.length>0&&(r.animations=e)}(),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length)return{geometry:r};var n=THREE.Loader.prototype.initMaterials(t.materials,e,this.crossOrigin);return{geometry:r,materials:n}}},THREE.MTLLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(t,e,r,i){var n=this,a=new THREE.XHRLoader(this.manager);a.setPath(this.path),a.load(t,function(t){e(n.parse(t))},r,i)},setPath:function(t){this.path=t},setBaseUrl:function(t){this.baseUrl=t},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split("\n"),r={},i=/\s+/,n={},a=0;a<e.length;a++){var o=e[a];if(0!==(o=o.trim()).length&&"#"!==o.charAt(0)){var s=o.indexOf(" "),u=s>=0?o.substring(0,s):o;u=u.toLowerCase();var c=s>=0?o.substring(s+1):"";if(c=c.trim(),"newmtl"===u)r={name:c},n[c]=r;else if(r)if("ka"===u||"kd"===u||"ks"===u){var l=c.split(i,3);r[u]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else r[u]=c}}var h=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(n),h}},THREE.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var r in t){var i=t[r],n={};e[r]=n;for(var a in i){var o=!0,s=i[a],u=a.toLowerCase();switch(u){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(o=!1)}o&&(n[u]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this.materialsInfo[t],r={name:t,side:this.side};for(var i in e){var n=e[i];if(""!==n)switch(i.toLowerCase()){case"kd":r.color=(new THREE.Color).fromArray(n);break;case"ks":r.specular=(new THREE.Color).fromArray(n);break;case"map_kd":r.map=this.loadTexture(this.baseUrl+n),r.map.wrapS=this.wrap,r.map.wrapT=this.wrap;break;case"ns":r.shininess=parseFloat(n);break;case"d":n<1&&(r.opacity=n,r.transparent=!0);break;case"Tr":n>0&&(r.opacity=1-n,r.transparent=!0);break;case"map_bump":case"bump":if(r.bumpMap)break;r.bumpMap=this.loadTexture(this.baseUrl+n),r.bumpMap.wrapS=this.wrap,r.bumpMap.wrapT=this.wrap}}return this.materials[t]=new THREE.MeshPhongMaterial(r),this.materials[t]},loadTexture:function(t,e,r,i,n){var a,o=THREE.Loader.Handlers.get(t),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),a=o.load(t,r,i,n),void 0!==e&&(a.mapping=e),a}},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype),THREE.OBJLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(t,e,r,i){var n=this,a=new THREE.XHRLoader(n.manager);a.setPath(this.path),a.load(t,function(t){e(n.parse(t))},r,i)},setPath:function(t){this.path=t},setMaterials:function(t){this.materials=t},_createParserState:function(){var t={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var i={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},r&&r.name&&"function"==typeof r.clone){var i=r.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseNormalIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseUVIndex:function(t,e){var r=parseInt(t,10);return 2*(r>=0?r-1:r+e/2)},addVertex:function(t,e,r){var i=this.vertices,n=this.object.geometry.vertices;n.push(i[t+0]),n.push(i[t+1]),n.push(i[t+2]),n.push(i[e+0]),n.push(i[e+1]),n.push(i[e+2]),n.push(i[r+0]),n.push(i[r+1]),n.push(i[r+2])},addVertexLine:function(t){var e=this.vertices,r=this.object.geometry.vertices;r.push(e[t+0]),r.push(e[t+1]),r.push(e[t+2])},addNormal:function(t,e,r){var i=this.normals,n=this.object.geometry.normals;n.push(i[t+0]),n.push(i[t+1]),n.push(i[t+2]),n.push(i[e+0]),n.push(i[e+1]),n.push(i[e+2]),n.push(i[r+0]),n.push(i[r+1]),n.push(i[r+2])},addUV:function(t,e,r){var i=this.uvs,n=this.object.geometry.uvs;n.push(i[t+0]),n.push(i[t+1]),n.push(i[e+0]),n.push(i[e+1]),n.push(i[r+0]),n.push(i[r+1])},addUVLine:function(t){var e=this.uvs,r=this.object.geometry.uvs;r.push(e[t+0]),r.push(e[t+1])},addFace:function(t,e,r,i,n,a,o,s,u,c,l,h){var p,d=this.vertices.length,f=this.parseVertexIndex(t,d),g=this.parseVertexIndex(e,d),m=this.parseVertexIndex(r,d);if(void 0===i?this.addVertex(f,g,m):(p=this.parseVertexIndex(i,d),this.addVertex(f,g,p),this.addVertex(g,m,p)),void 0!==n){var E=this.uvs.length;f=this.parseUVIndex(n,E),g=this.parseUVIndex(a,E),m=this.parseUVIndex(o,E),void 0===i?this.addUV(f,g,m):(p=this.parseUVIndex(s,E),this.addUV(f,g,p),this.addUV(g,m,p))}if(void 0!==u){var v=this.normals.length;f=this.parseNormalIndex(u,v),g=u===c?f:this.parseNormalIndex(c,v),m=u===l?f:this.parseNormalIndex(l,v),void 0===i?this.addNormal(f,g,m):(p=this.parseNormalIndex(h,v),this.addNormal(f,g,p),this.addNormal(g,m,p))}},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var r=this.vertices.length,i=this.uvs.length,n=0,a=t.length;n<a;n++)this.addVertexLine(this.parseVertexIndex(t[n],r));for(var o=0,a=e.length;o<a;o++)this.addUVLine(this.parseUVIndex(e[o],i))}};return t.startObject("",!1),t},parse:function(t){console.time("OBJLoader");var e=this._createParserState();-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));for(var r=t.split("\n"),i="",n="",a="",o=[],s="function"==typeof"".trimLeft,u=0,c=r.length;u<c;u++)if(i=r[u],i=s?i.trimLeft():i.trim(),0!==i.length&&"#"!==(n=i.charAt(0)))if("v"===n)if(" "===(a=i.charAt(1))&&null!==(o=this.regexp.vertex_pattern.exec(i)))e.vertices.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if("n"===a&&null!==(o=this.regexp.normal_pattern.exec(i)))e.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else{if("t"!==a||null===(o=this.regexp.uv_pattern.exec(i)))throw new Error("Unexpected vertex/normal/uv line: '"+i+"'");e.uvs.push(parseFloat(o[1]),parseFloat(o[2]))}else if("f"===n)if(null!==(o=this.regexp.face_vertex_uv_normal.exec(i)))e.addFace(o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],o[3],o[6],o[9],o[12]);else if(null!==(o=this.regexp.face_vertex_uv.exec(i)))e.addFace(o[1],o[3],o[5],o[7],o[2],o[4],o[6],o[8]);else if(null!==(o=this.regexp.face_vertex_normal.exec(i)))e.addFace(o[1],o[3],o[5],o[7],void 0,void 0,void 0,void 0,o[2],o[4],o[6],o[8]);else{if(null===(o=this.regexp.face_vertex.exec(i)))throw new Error("Unexpected face line: '"+i+"'");e.addFace(o[1],o[2],o[3],o[4])}else if("l"===n){var l=i.substring(1).trim().split(" "),h=[],p=[];if(-1===i.indexOf("/"))h=l;else for(var d=0,f=l.length;d<f;d++){var g=l[d].split("/");""!==g[0]&&h.push(g[0]),""!==g[1]&&p.push(g[1])}e.addLineGeometry(h,p)}else if(null!==(o=this.regexp.object_pattern.exec(i))){var m=(" "+o[0].substr(1).trim()).substr(1);e.startObject(m)}else if(this.regexp.material_use_pattern.test(i))e.object.startMaterial(i.substring(7).trim(),e.materialLibraries);else if(this.regexp.material_library_pattern.test(i))e.materialLibraries.push(i.substring(7).trim());else{if(null===(o=this.regexp.smoothing_pattern.exec(i))){if("\0"===i)continue;throw new Error("Unexpected line: '"+i+"'")}var E=o[1].trim().toLowerCase();e.object.smooth="1"===E||"on"===E,(R=e.object.currentMaterial())&&(R.smooth=e.object.smooth)}e.finalize();var v=new THREE.Group;v.materialLibraries=[].concat(e.materialLibraries);for(var u=0,c=e.objects.length;u<c;u++){var y=e.objects[u],T=y.geometry,A=y.materials,S="Line"===T.type;if(0!==T.vertices.length){var x=new THREE.BufferGeometry;x.addAttribute("position",new THREE.BufferAttribute(new Float32Array(T.vertices),3)),T.normals.length>0?x.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(T.normals),3)):x.computeVertexNormals(),T.uvs.length>0&&x.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(T.uvs),2));for(var _=[],b=0,P=A.length;b<P;b++){var C=A[b],R=void 0;if(null!==this.materials&&(R=this.materials.create(C.name),S&&R&&!(R instanceof THREE.LineBasicMaterial))){var O=new THREE.LineBasicMaterial;O.copy(R),R=O}R||((R=S?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=C.name),R.shading=C.smooth?THREE.SmoothShading:THREE.FlatShading,_.push(R)}var w;if(_.length>1){for(var b=0,P=A.length;b<P;b++){C=A[b];x.addGroup(C.groupStart,C.groupCount,b)}var I=new THREE.MultiMaterial(_);w=S?new THREE.LineSegments(x,I):new THREE.Mesh(x,I)}else w=S?new THREE.LineSegments(x,_[0]):new THREE.Mesh(x,_[0]);w.name=y.name,v.add(w)}}return console.timeEnd("OBJLoader"),v}};var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE),SPE.TypedArrayHelper=function(t,e,r,i){"use strict";this.componentSize=r||1,this.size=e||1,this.TypedArrayConstructor=t||Float32Array,this.array=new t(e*this.componentSize),this.indexOffset=i||0},SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper,SPE.TypedArrayHelper.prototype.setSize=function(t,e){"use strict";var r=this.array.length;return e||(t*=this.componentSize),t<r?this.shrink(t):t>r?this.grow(t):void console.info("TypedArray is already of size:",t+".","Will not resize.")},SPE.TypedArrayHelper.prototype.shrink=function(t){"use strict";return this.array=this.array.subarray(0,t),this.size=t,this},SPE.TypedArrayHelper.prototype.grow=function(t){"use strict";var e=this.array,r=new this.TypedArrayConstructor(t);return r.set(e),this.array=r,this.size=t,this},SPE.TypedArrayHelper.prototype.splice=function(t,e){"use strict";t*=this.componentSize,e*=this.componentSize;for(var r=[],i=this.array,n=i.length,a=0;a<n;++a)(a<t||a>=e)&&r.push(i[a]);return this.setFromArray(0,r),this},SPE.TypedArrayHelper.prototype.setFromArray=function(t,e){"use strict";var r=t+e.length;return r>this.array.length?this.grow(r):r<this.array.length&&this.shrink(r),this.array.set(e,this.indexOffset+t),this},SPE.TypedArrayHelper.prototype.setVec2=function(t,e){"use strict";return this.setVec2Components(t,e.x,e.y)},SPE.TypedArrayHelper.prototype.setVec2Components=function(t,e,r){"use strict";var i=this.array,n=this.indexOffset+t*this.componentSize;return i[n]=e,i[n+1]=r,this},SPE.TypedArrayHelper.prototype.setVec3=function(t,e){"use strict";return this.setVec3Components(t,e.x,e.y,e.z)},SPE.TypedArrayHelper.prototype.setVec3Components=function(t,e,r,i){"use strict";var n=this.array,a=this.indexOffset+t*this.componentSize;return n[a]=e,n[a+1]=r,n[a+2]=i,this},SPE.TypedArrayHelper.prototype.setVec4=function(t,e){"use strict";return this.setVec4Components(t,e.x,e.y,e.z,e.w)},SPE.TypedArrayHelper.prototype.setVec4Components=function(t,e,r,i,n){"use strict";var a=this.array,o=this.indexOffset+t*this.componentSize;return a[o]=e,a[o+1]=r,a[o+2]=i,a[o+3]=n,this},SPE.TypedArrayHelper.prototype.setMat3=function(t,e){"use strict";return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},SPE.TypedArrayHelper.prototype.setMat4=function(t,e){"use strict";return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},SPE.TypedArrayHelper.prototype.setColor=function(t,e){"use strict";return this.setVec3Components(t,e.r,e.g,e.b)},SPE.TypedArrayHelper.prototype.setNumber=function(t,e){"use strict";return this.array[this.indexOffset+t*this.componentSize]=e,this},SPE.TypedArrayHelper.prototype.getValueAtIndex=function(t){"use strict";return this.array[this.indexOffset+t]},SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(t){"use strict";return this.array.subarray(this.indexOffset+t*this.componentSize)},SPE.ShaderAttribute=function(t,e,r){"use strict";var i=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof t&&i.hasOwnProperty(t)?t:"f",this.componentSize=i[this.type],this.arrayType=r||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!e,this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.constructor=SPE.ShaderAttribute,SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},SPE.ShaderAttribute.prototype.setUpdateRange=function(t,e){"use strict";this.updateMin=Math.min(t*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(e*this.componentSize,this.updateMax*this.componentSize)},SPE.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var t=this.bufferAttribute,e=t.updateRange;e.offset=this.updateMin,e.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),t.needsUpdate=!0},SPE.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.splice=function(t,e){"use strict";this.typedArray.splice(t,e),this.forceUpdateAll()},SPE.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},SPE.ShaderAttribute.prototype._ensureTypedArray=function(t){"use strict";null!==this.typedArray&&this.typedArray.size===t*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==t?this.typedArray.setSize(t):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,t,this.componentSize)))},SPE.ShaderAttribute.prototype._createBufferAttribute=function(t){"use strict";if(this._ensureTypedArray(t),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,parseFloat(THREE.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},SPE.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D texture;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( texture, vUv );"].join("\n")},SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(t,e,r){"use strict";return typeof t===e?t:r},ensureArrayTypedArg:function(t,e,r){"use strict";if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(typeof t[i]!==e)return r;return t}return this.ensureTypedArg(t,e,r)},ensureInstanceOf:function(t,e,r){"use strict";return void 0!==e&&t instanceof e?t:r},ensureArrayInstanceOf:function(t,e,r){"use strict";if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(void 0!==e&&t[i]instanceof e==!1)return r;return t}return this.ensureInstanceOf(t,e,r)},ensureValueOverLifetimeCompliance:function(t,e,r){"use strict";e=e||3,r=r||3,!1===Array.isArray(t._value)&&(t._value=[t._value]),!1===Array.isArray(t._spread)&&(t._spread=[t._spread]);var i=this.clamp(t._value.length,e,r),n=this.clamp(t._spread.length,e,r),a=Math.max(i,n);t._value.length!==a&&(t._value=this.interpolateArray(t._value,a)),t._spread.length!==a&&(t._spread=this.interpolateArray(t._spread,a))},interpolateArray:function(t,e){"use strict";for(var r=t.length,i=["function"==typeof t[0].clone?t[0].clone():t[0]],n=(r-1)/(e-1),a=1;a<e-1;++a){var o=a*n,s=Math.floor(o),u=Math.ceil(o),c=o-s;i[a]=this.lerpTypeAgnostic(t[s],t[u],c)}return i.push("function"==typeof t[r-1].clone?t[r-1].clone():t[r-1]),i},clamp:function(t,e,r){"use strict";return Math.max(e,Math.min(t,r))},zeroToEpsilon:function(t,e){"use strict";var r=t;return r=e?1e-5*Math.random()*10:1e-5,t<0&&t>-1e-5&&(r=-r),r},lerpTypeAgnostic:function(t,e,r){"use strict";var i,n=this.types;return typeof t===n.NUMBER&&typeof e===n.NUMBER?t+(e-t)*r:t instanceof THREE.Vector2&&e instanceof THREE.Vector2?(i=t.clone(),i.x=this.lerp(t.x,e.x,r),i.y=this.lerp(t.y,e.y,r),i):t instanceof THREE.Vector3&&e instanceof THREE.Vector3?(i=t.clone(),i.x=this.lerp(t.x,e.x,r),i.y=this.lerp(t.y,e.y,r),i.z=this.lerp(t.z,e.z,r),i):t instanceof THREE.Vector4&&e instanceof THREE.Vector4?(i=t.clone(),i.x=this.lerp(t.x,e.x,r),i.y=this.lerp(t.y,e.y,r),i.z=this.lerp(t.z,e.z,r),i.w=this.lerp(t.w,e.w,r),i):t instanceof THREE.Color&&e instanceof THREE.Color?(i=t.clone(),i.r=this.lerp(t.r,e.r,r),i.g=this.lerp(t.g,e.g,r),i.b=this.lerp(t.b,e.b,r),i):void console.warn("Invalid argument types, or argument types do not match:",t,e)},lerp:function(t,e,r){"use strict";return t+(e-t)*r},roundToNearestMultiple:function(t,e){"use strict";var r=0;return 0===e?t:0==(r=Math.abs(t)%e)?t:t<0?-(Math.abs(t)-r):t+e-r},arrayValuesAreEqual:function(t){"use strict";for(var e=0;e<t.length-1;++e)if(t[e]!==t[e+1])return!1;return!0},randomFloat:function(t,e){"use strict";return t+e*(Math.random()-.5)},randomVector3:function(t,e,r,i,n){"use strict";var a=r.x+(Math.random()*i.x-.5*i.x),o=r.y+(Math.random()*i.y-.5*i.y),s=r.z+(Math.random()*i.z-.5*i.z);n&&(a=.5*-n.x+this.roundToNearestMultiple(a,n.x),o=.5*-n.y+this.roundToNearestMultiple(o,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),t.typedArray.setVec3Components(e,a,o,s)},randomColor:function(t,e,r,i){"use strict";var n=r.r+Math.random()*i.x,a=r.g+Math.random()*i.y,o=r.b+Math.random()*i.z;n=this.clamp(n,0,1),a=this.clamp(a,0,1),o=this.clamp(o,0,1),t.typedArray.setVec3Components(e,n,a,o)},randomColorAsHex:function(){"use strict";var t=new THREE.Color;return function(e,r,i,n){for(var a=i.length,o=[],s=0;s<a;++s){var u=n[s];t.copy(i[s]),t.r+=Math.random()*u.x-.5*u.x,t.g+=Math.random()*u.y-.5*u.y,t.b+=Math.random()*u.z-.5*u.z,t.r=this.clamp(t.r,0,1),t.g=this.clamp(t.g,0,1),t.b=this.clamp(t.b,0,1),o.push(t.getHex())}e.typedArray.setVec4Components(r,o[0],o[1],o[2],o[3])}}(),randomVector3OnSphere:function(t,e,r,i,n,a,o,s){"use strict";var u=2*Math.random()-1,c=6.2832*Math.random(),l=Math.sqrt(1-u*u),h=this.randomFloat(i,n),p=0,d=0,f=0;o&&(h=Math.round(h/o)*o),p=l*Math.cos(c)*h,d=l*Math.sin(c)*h,f=u*h,p*=a.x,d*=a.y,f*=a.z,p+=r.x,d+=r.y,f+=r.z,t.typedArray.setVec3Components(e,p,d,f)},seededRandom:function(t){var e=1e4*Math.sin(t);return e-(0|e)},randomVector3OnDisc:function(t,e,r,i,n,a,o){"use strict";var s=6.2832*Math.random(),u=Math.abs(this.randomFloat(i,n)),c=0,l=0,h=0;o&&(u=Math.round(u/o)*o),c=Math.cos(s)*u,l=Math.sin(s)*u,c*=a.x,l*=a.y,c+=r.x,l+=r.y,h+=r.z,t.typedArray.setVec3Components(e,c,l,h)},randomDirectionVector3OnSphere:function(){"use strict";var t=new THREE.Vector3;return function(e,r,i,n,a,o,s,u){t.copy(o),t.x-=i,t.y-=n,t.z-=a,t.normalize().multiplyScalar(-this.randomFloat(s,u)),e.typedArray.setVec3Components(r,t.x,t.y,t.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var t=new THREE.Vector3;return function(e,r,i,n,a,o,s,u){t.copy(o),t.x-=i,t.y-=n,t.z-=a,t.normalize().multiplyScalar(-this.randomFloat(s,u)),e.typedArray.setVec3Components(r,t.x,t.y,0)}}(),getPackedRotationAxis:function(){"use strict";var t=new THREE.Vector3,e=new THREE.Vector3,r=new THREE.Color,i=new THREE.Vector3(1,1,1);return function(n,a){return t.copy(n).normalize(),e.copy(a).normalize(),t.x+=.5*-a.x+Math.random()*a.x,t.y+=.5*-a.y+Math.random()*a.y,t.z+=.5*-a.z+Math.random()*a.z,t.normalize().add(i).multiplyScalar(.5),r.setRGB(t.x,t.y,t.z),r.getHex()}}()},SPE.Group=function(t){"use strict";var e=SPE.utils,r=e.types;(t=e.ensureTypedArg(t,r.OBJECT,{})).texture=e.ensureTypedArg(t.texture,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=e.ensureTypedArg(t.fixedTimeStep,r.NUMBER,.016),this.texture=e.ensureInstanceOf(t.texture.value,THREE.Texture,null),this.textureFrames=e.ensureInstanceOf(t.texture.frames,THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=e.ensureTypedArg(t.texture.frameCount,r.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=e.ensureTypedArg(t.texture.loop,r.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=e.ensureTypedArg(t.hasPerspective,r.BOOLEAN,!0),this.colorize=e.ensureTypedArg(t.colorize,r.BOOLEAN,!0),this.maxParticleCount=e.ensureTypedArg(t.maxParticleCount,r.NUMBER,null),this.blending=e.ensureTypedArg(t.blending,r.NUMBER,THREE.AdditiveBlending),this.transparent=e.ensureTypedArg(t.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(e.ensureTypedArg(t.alphaTest,r.NUMBER,0)),this.depthWrite=e.ensureTypedArg(t.depthWrite,r.BOOLEAN,!1),this.depthTest=e.ensureTypedArg(t.depthTest,r.BOOLEAN,!0),this.fog=e.ensureTypedArg(t.fog,r.BOOLEAN,!0),this.scale=e.ensureTypedArg(t.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={texture:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},SPE.Group.constructor=SPE.Group,SPE.Group.prototype._updateDefines=function(){"use strict";var t,e=this.emitters,r=e.length-1,i=this.defines;for(r;r>=0;--r)t=e[r],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,t.angle.value),Math.max.apply(null,t.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(t.rotation.angle,t.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(t.wiggle.value,t.wiggle.spread);this.material.needsUpdate=!0},SPE.Group.prototype._applyAttributesToGeometry=function(){"use strict";var t,e,r=this.attributes,i=this.geometry,n=i.attributes;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],(e=n[a])?e.array=t.typedArray.array:i.addAttribute(a,t.bufferAttribute),t.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},SPE.Group.prototype.addEmitter=function(t){"use strict";if(t instanceof SPE.Emitter!=!1)if(this.emitterIDs.indexOf(t.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===t.group){var e=this.attributes,r=this.particleCount,i=r+t.particleCount;this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),t._calculatePPSValue(t.maxAge._value+t.maxAge._spread),t._setBufferUpdateRanges(this.attributeKeys),t._setAttributeOffset(r),t.group=this,t.attributes=this.attributes;for(var n in e)e.hasOwnProperty(n)&&e[n]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var a=r;a<i;++a)t._assignPositionValue(a),t._assignForceValue(a,"velocity"),t._assignForceValue(a,"acceleration"),t._assignAbsLifetimeValue(a,"opacity"),t._assignAbsLifetimeValue(a,"size"),t._assignAngleValue(a),t._assignRotationValue(a),t._assignParamsValue(a),t._assignColorValue(a);return this._applyAttributesToGeometry(),this.emitters.push(t),this.emitterIDs.push(t.uuid),this._updateDefines(t),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",t)},SPE.Group.prototype.removeEmitter=function(t){"use strict";var e=this.emitterIDs.indexOf(t.uuid);if(t instanceof SPE.Emitter!=!1)if(-1!==e){for(var r=t.attributeOffset,i=r+t.particleCount,n=this.attributes.params.typedArray,a=r;a<i;++a)n.array[4*a]=0,n.array[4*a+1]=0;this.emitters.splice(e,1),this.emitterIDs.splice(e,1);for(var o in this.attributes)this.attributes.hasOwnProperty(o)&&this.attributes[o].splice(r,i);this.particleCount-=t.particleCount,t._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",t)},SPE.Group.prototype.getFromPool=function(){"use strict";var t=this._pool,e=this._createNewWhenPoolEmpty;if(t.length)return t.pop();if(e){var r=new SPE.Emitter(this._poolCreationSettings);return this.addEmitter(r),r}return null},SPE.Group.prototype.releaseIntoPool=function(t){"use strict";{if(t instanceof SPE.Emitter!=!1)return t.reset(),this._pool.unshift(t),this;console.error("Argument is not instanceof SPE.Emitter:",t)}},SPE.Group.prototype.getPool=function(){"use strict";return this._pool},SPE.Group.prototype.addPool=function(t,e,r){"use strict";var i;this._poolCreationSettings=e,this._createNewWhenPoolEmpty=!!r;for(var n=0;n<t;++n)i=Array.isArray(e)?new SPE.Emitter(e[n]):new SPE.Emitter(e),this.addEmitter(i),this.releaseIntoPool(i);return this},SPE.Group.prototype._triggerSingleEmitter=function(t){"use strict";var e=this.getFromPool(),r=this;{if(null!==e)return t instanceof THREE.Vector3&&(e.position.value.copy(t),e.position.value=e.position.value),e.enable(),setTimeout(function(){e.disable(),r.releaseIntoPool(e)},1e3*Math.max(e.duration,e.maxAge.value+e.maxAge.spread)),this;console.log("SPE.Group pool ran out.")}},SPE.Group.prototype.triggerPoolEmitter=function(t,e){"use strict";if("number"==typeof t&&t>1)for(var r=0;r<t;++r)this._triggerSingleEmitter(e);else this._triggerSingleEmitter(e);return this},SPE.Group.prototype._updateUniforms=function(t){"use strict";this.uniforms.runTime.value+=t,this.uniforms.deltaTime.value=t},SPE.Group.prototype._resetBufferRanges=function(){"use strict";var t=this.attributeKeys,e=this.attributeCount-1,r=this.attributes;for(e;e>=0;--e)r[t[e]].resetUpdateRange()},SPE.Group.prototype._updateBuffers=function(t){"use strict";var e,r,i,n=this.attributeKeys,a=this.attributeCount-1,o=this.attributes,s=t.bufferUpdateRanges;for(a;a>=0;--a)r=s[e=n[a]],(i=o[e]).setUpdateRange(r.min,r.max),i.flagUpdate()},SPE.Group.prototype.tick=function(t){"use strict";var e=this.emitters,r=e.length,i=t||this.fixedTimeStep,n=this.attributeKeys,a=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),0!==r||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var o,s=0;s<r;++s)(o=e[s]).tick(i),this._updateBuffers(o);if(!0===this._attributesNeedDynamicReset){for(s=this.attributeCount-1;s>=0;--s)a[n[s]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(s=this.attributeCount-1;s>=0;--s)a[n[s]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},SPE.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},SPE.Emitter=function(t){"use strict";var e=SPE.utils,r=e.types,i=SPE.valueOverLifetimeLength;(t=e.ensureTypedArg(t,r.OBJECT,{})).position=e.ensureTypedArg(t.position,r.OBJECT,{}),t.velocity=e.ensureTypedArg(t.velocity,r.OBJECT,{}),t.acceleration=e.ensureTypedArg(t.acceleration,r.OBJECT,{}),t.radius=e.ensureTypedArg(t.radius,r.OBJECT,{}),t.drag=e.ensureTypedArg(t.drag,r.OBJECT,{}),t.rotation=e.ensureTypedArg(t.rotation,r.OBJECT,{}),t.color=e.ensureTypedArg(t.color,r.OBJECT,{}),t.opacity=e.ensureTypedArg(t.opacity,r.OBJECT,{}),t.size=e.ensureTypedArg(t.size,r.OBJECT,{}),t.angle=e.ensureTypedArg(t.angle,r.OBJECT,{}),t.wiggle=e.ensureTypedArg(t.wiggle,r.OBJECT,{}),t.maxAge=e.ensureTypedArg(t.maxAge,r.OBJECT,{}),t.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=e.ensureTypedArg(t.type,r.NUMBER,SPE.distributions.BOX),this.position={_value:e.ensureInstanceOf(t.position.value,THREE.Vector3,new THREE.Vector3),_spread:e.ensureInstanceOf(t.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:e.ensureInstanceOf(t.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:e.ensureTypedArg(t.position.distribution,r.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1),_radius:e.ensureTypedArg(t.position.radius,r.NUMBER,10),_radiusScale:e.ensureInstanceOf(t.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:e.ensureTypedArg(t.position.distributionClamp,r.NUMBER,0)},this.velocity={_value:e.ensureInstanceOf(t.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:e.ensureInstanceOf(t.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:e.ensureTypedArg(t.velocity.distribution,r.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.acceleration={_value:e.ensureInstanceOf(t.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:e.ensureInstanceOf(t.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:e.ensureTypedArg(t.acceleration.distribution,r.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.drag={_value:e.ensureTypedArg(t.drag.value,r.NUMBER,0),_spread:e.ensureTypedArg(t.drag.spread,r.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.wiggle={_value:e.ensureTypedArg(t.wiggle.value,r.NUMBER,0),_spread:e.ensureTypedArg(t.wiggle.spread,r.NUMBER,0)},this.rotation={_axis:e.ensureInstanceOf(t.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:e.ensureInstanceOf(t.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:e.ensureTypedArg(t.rotation.angle,r.NUMBER,0),_angleSpread:e.ensureTypedArg(t.rotation.angleSpread,r.NUMBER,0),_static:e.ensureTypedArg(t.rotation.static,r.BOOLEAN,!1),_center:e.ensureInstanceOf(t.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.maxAge={_value:e.ensureTypedArg(t.maxAge.value,r.NUMBER,2),_spread:e.ensureTypedArg(t.maxAge.spread,r.NUMBER,0)},this.color={_value:e.ensureArrayInstanceOf(t.color.value,THREE.Color,new THREE.Color),_spread:e.ensureArrayInstanceOf(t.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.opacity={_value:e.ensureArrayTypedArg(t.opacity.value,r.NUMBER,1),_spread:e.ensureArrayTypedArg(t.opacity.spread,r.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.size={_value:e.ensureArrayTypedArg(t.size.value,r.NUMBER,1),_spread:e.ensureArrayTypedArg(t.size.spread,r.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.angle={_value:e.ensureArrayTypedArg(t.angle.value,r.NUMBER,0),_spread:e.ensureArrayTypedArg(t.angle.spread,r.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)},this.particleCount=e.ensureTypedArg(t.particleCount,r.NUMBER,100),this.duration=e.ensureTypedArg(t.duration,r.NUMBER,null),this.isStatic=e.ensureTypedArg(t.isStatic,r.BOOLEAN,!1),this.activeMultiplier=e.ensureTypedArg(t.activeMultiplier,r.NUMBER,1),this.direction=e.ensureTypedArg(t.direction,r.NUMBER,1),this.alive=e.ensureTypedArg(t.alive,r.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:e.ensureTypedArg(t.position.randomise,r.BOOLEAN,!1)||e.ensureTypedArg(t.radius.randomise,r.BOOLEAN,!1),velocity:e.ensureTypedArg(t.velocity.randomise,r.BOOLEAN,!1),acceleration:e.ensureTypedArg(t.acceleration.randomise,r.BOOLEAN,!1)||e.ensureTypedArg(t.drag.randomise,r.BOOLEAN,!1),rotation:e.ensureTypedArg(t.rotation.randomise,r.BOOLEAN,!1),rotationCenter:e.ensureTypedArg(t.rotation.randomise,r.BOOLEAN,!1),size:e.ensureTypedArg(t.size.randomise,r.BOOLEAN,!1),color:e.ensureTypedArg(t.color.randomise,r.BOOLEAN,!1),opacity:e.ensureTypedArg(t.opacity.randomise,r.BOOLEAN,!1),angle:e.ensureTypedArg(t.angle.randomise,r.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var n in this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,e.ensureValueOverLifetimeCompliance(this.color,i,i),e.ensureValueOverLifetimeCompliance(this.opacity,i,i),e.ensureValueOverLifetimeCompliance(this.size,i,i),e.ensureValueOverLifetimeCompliance(this.angle,i,i)},SPE.Emitter.constructor=SPE.Emitter,SPE.Emitter.prototype._createGetterSetters=function(t,e){"use strict";var r=this;for(var i in t)if(t.hasOwnProperty(i)){var n=i.replace("_","");Object.defineProperty(t,n,{get:function(t){return function(){return this[t]}}(i),set:function(t){return function(i){var n=r.updateMap[e],a=this[t],o=SPE.valueOverLifetimeLength;"_rotationCenter"===t?(r.updateFlags.rotationCenter=!0,r.updateCounts.rotationCenter=0):"_randomise"===t?r.resetFlags[n]=i:(r.updateFlags[n]=!0,r.updateCounts[n]=0),r.group._updateDefines(),this[t]=i,Array.isArray(a)&&SPE.utils.ensureValueOverLifetimeCompliance(r[e],o,o)}}(i)})}},SPE.Emitter.prototype._setBufferUpdateRanges=function(t){"use strict";this.attributeKeys=t,this.attributeCount=t.length;for(var e=this.attributeCount-1;e>=0;--e)this.bufferUpdateRanges[t[e]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},SPE.Emitter.prototype._calculatePPSValue=function(t){"use strict";var e=this.particleCount;this.duration?this.particlesPerSecond=e/(t<this.duration?t:this.duration):this.particlesPerSecond=e/t},SPE.Emitter.prototype._setAttributeOffset=function(t){this.attributeOffset=t,this.activationIndex=t,this.activationEnd=t+this.particleCount},SPE.Emitter.prototype._assignValue=function(t,e){"use strict";switch(t){case"position":this._assignPositionValue(e);break;case"velocity":case"acceleration":this._assignForceValue(e,t);break;case"size":case"opacity":this._assignAbsLifetimeValue(e,t);break;case"angle":this._assignAngleValue(e);break;case"params":this._assignParamsValue(e);break;case"rotation":this._assignRotationValue(e);break;case"color":this._assignColorValue(e)}},SPE.Emitter.prototype._assignPositionValue=function(t){"use strict";var e=SPE.distributions,r=SPE.utils,i=this.position,n=this.attributes.position,a=i._value,o=i._spread;switch(i._distribution){case e.BOX:r.randomVector3(n,t,a,o,i._spreadClamp);break;case e.SPHERE:r.randomVector3OnSphere(n,t,a,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case e.DISC:r.randomVector3OnDisc(n,t,a,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}},SPE.Emitter.prototype._assignForceValue=function(t,e){"use strict";var r,i,n,a,o,s=SPE.distributions,u=SPE.utils,c=this[e],l=c._value,h=c._spread;switch(c._distribution){case s.BOX:u.randomVector3(this.attributes[e],t,l,h);break;case s.SPHERE:i=(r=this.attributes.position.typedArray.array)[o=3*t],n=r[o+1],a=r[o+2],u.randomDirectionVector3OnSphere(this.attributes[e],t,i,n,a,this.position._value,c._value.x,c._spread.x);break;case s.DISC:i=(r=this.attributes.position.typedArray.array)[o=3*t],n=r[o+1],a=r[o+2],u.randomDirectionVector3OnDisc(this.attributes[e],t,i,n,a,this.position._value,c._value.x,c._spread.x)}if("acceleration"===e){var p=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[4*t+3]=p}},SPE.Emitter.prototype._assignAbsLifetimeValue=function(t,e){"use strict";var r,i=this.attributes[e].typedArray,n=this[e],a=SPE.utils;a.arrayValuesAreEqual(n._value)&&a.arrayValuesAreEqual(n._spread)?(r=Math.abs(a.randomFloat(n._value[0],n._spread[0])),i.setVec4Components(t,r,r,r,r)):i.setVec4Components(t,Math.abs(a.randomFloat(n._value[0],n._spread[0])),Math.abs(a.randomFloat(n._value[1],n._spread[1])),Math.abs(a.randomFloat(n._value[2],n._spread[2])),Math.abs(a.randomFloat(n._value[3],n._spread[3])))},SPE.Emitter.prototype._assignAngleValue=function(t){"use strict";var e,r=this.attributes.angle.typedArray,i=this.angle,n=SPE.utils;n.arrayValuesAreEqual(i._value)&&n.arrayValuesAreEqual(i._spread)?(e=n.randomFloat(i._value[0],i._spread[0]),r.setVec4Components(t,e,e,e,e)):r.setVec4Components(t,n.randomFloat(i._value[0],i._spread[0]),n.randomFloat(i._value[1],i._spread[1]),n.randomFloat(i._value[2],i._spread[2]),n.randomFloat(i._value[3],i._spread[3]))},SPE.Emitter.prototype._assignParamsValue=function(t){"use strict";this.attributes.params.typedArray.setVec4Components(t,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},SPE.Emitter.prototype._assignRotationValue=function(t){"use strict";this.attributes.rotation.typedArray.setVec3Components(t,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(t,this.rotation._center)},SPE.Emitter.prototype._assignColorValue=function(t){"use strict";SPE.utils.randomColorAsHex(this.attributes.color,t,this.color._value,this.color._spread)},SPE.Emitter.prototype._resetParticle=function(t){"use strict";for(var e,r,i=this.resetFlags,n=this.updateFlags,a=this.updateCounts,o=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)r=n[e=o[s]],!0!==i[e]&&!0!==r||(this._assignValue(e,t),this._updateAttributeUpdateRange(e,t),!0===r&&a[e]===this.particleCount?(n[e]=!1,a[e]=0):1==r&&++a[e])},SPE.Emitter.prototype._updateAttributeUpdateRange=function(t,e){"use strict";var r=this.bufferUpdateRanges[t];r.min=Math.min(e,r.min),r.max=Math.max(e,r.max)},SPE.Emitter.prototype._resetBufferRanges=function(){"use strict";var t,e=this.bufferUpdateRanges,r=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;for(i;i>=0;--i)e[t=r[i]].min=Number.POSITIVE_INFINITY,e[t].max=Number.NEGATIVE_INFINITY},SPE.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},SPE.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},SPE.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},SPE.Emitter.prototype._checkParticleAges=function(t,e,r,i){"use strict";for(var n,a,o,s,u=e-1;u>=t;--u)0!==(s=r[n=4*u])&&(o=r[n+1],a=r[n+2],1===this.direction?(o+=i)>=a&&(o=0,s=0,this._decrementParticleCount()):(o-=i)<=0&&(o=a,s=0,this._decrementParticleCount()),r[n]=s,r[n+1]=o,this._updateAttributeUpdateRange("params",u))},SPE.Emitter.prototype._activateParticles=function(t,e,r,i){"use strict";for(var n,a,o=this.direction,s=t;s<e;++s)0!=r[n=4*s]&&1!==this.particleCount||(this._incrementParticleCount(),r[n]=1,this._resetParticle(s),a=i*(s-t),r[n+1]=-1===o?r[n+2]-a:a,this._updateAttributeUpdateRange("params",s))},SPE.Emitter.prototype.tick=function(t){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var e=this.attributeOffset,r=e+this.particleCount,i=this.paramsArray,n=this.particlesPerSecond*this.activeMultiplier*t,a=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(e,r,i,t),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var o=1===this.particleCount?a:0|a,s=Math.min(o+n,this.activationEnd),u=s-this.activationIndex|0,c=u>0?t/u:0;this._activateParticles(o,s,i,c),this.activationIndex+=n,this.activationIndex>r&&(this.activationIndex=e),this.age+=t}else this.age=0}},SPE.Emitter.prototype.reset=function(t){"use strict";if(this.age=0,this.alive=!1,!0===t){for(var e,r=this.attributeOffset,i=r+this.particleCount,n=this.paramsArray,a=this.attributes.params.bufferAttribute,o=i-1;o>=r;--o)n[e=4*o]=0,n[e+1]=0;a.updateRange.offset=0,a.updateRange.count=-1,a.needsUpdate=!0}return this},SPE.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},SPE.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},SPE.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this},THREE.TextureLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(t,e,r,i){var n=new THREE.Texture,a=new THREE.ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(t){n.image=t,n.needsUpdate=!0,void 0!==e&&e(n)},r,i),n},setCrossOrigin:function(t){this.crossOrigin=t},setPath:function(t){this.path=t}},function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define(e):t.touch=e()}(this,function(){var t={};t.PCevts={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touchcancel:"mouseout"},t.hasTouch="ontouchstart"in window,t.getType=function(t){return Object.prototype.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t.getSelector=function(t){return t.id?"#"+t.id:t.className?"."+t.className.split(/\s+/).join("."):t===document?"body":t.tagName.toLowerCase()},t.matchSelector=function(t,e){return t.webkitMatchesSelector(e)},t.getEventListeners=function(t){return t.listeners},t.getPCevts=function(t){return this.PCevts[t]||t},t.forceReflow=function(){var t=document.getElementById("reflowDivBlock");t||((t=document.createElement("div")).id="reflowDivBlock",document.body.appendChild(t));var e=t.parentNode,r=t.nextSibling;e.removeChild(t),e.insertBefore(t,r)},t.simpleClone=function(t){return Object.create(t)},t.getPosOfEvent=function(t){if(this.hasTouch){for(var e=[],r=null,i=0,n=t.touches.length;i<n;i++)r=t.touches[i],e.push({x:r.pageX,y:r.pageY});return e}return[{x:t.pageX,y:t.pageY}]},t.getDistance=function(t,e){var r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)},t.getFingers=function(t){return t.touches?t.touches.length:1},t.calScale=function(t,e){if(t.length>=2&&e.length>=2){var r=this.getDistance(t[1],t[0]);return this.getDistance(e[1],e[0])/r}return 1},t.getAngle=function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},t.getAngle180=function(t,e){var r=Math.atan(-1*(e.y-t.y)/(e.x-t.x))*(180/Math.PI);return r<0?r+180:r},t.getDirectionFromAngle=function(t){var e={up:t<-45&&t>-135,down:t>=45&&t<135,left:t>=135||t<=-135,right:t>=-45&&t<=45};for(var r in e)if(e[r])return r;return null},t.getXYByElement=function(t){for(var e=0,r=0;t.offsetParent;)e+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return{left:e,top:r}},t.reset=function(){o=s=u=null,g=d=c=l=!1,h=!1,n={},v=!1},t.isTouchMove=function(t){return"touchmove"===t.type||"mousemove"===t.type},t.isTouchEnd=function(t){return"touchend"===t.type||"mouseup"===t.type||"touchcancel"===t.type},t.env=function(){var t={},e=navigator.userAgent,r=e.match(/(Android)[\s\/]+([\d\.]+)/),i=e.match(/(iPad|iPhone|iPod)\s+OS\s([\d_\.]+)/),n=e.match(/(Windows\s+Phone)\s([\d\.]+)/),a=/WebKit\/[\d.]+/i.test(e),o=!!i&&(navigator.standalone?a:/Safari/i.test(e)&&!/CriOS/i.test(e)&&!/MQQBrowser/i.test(e));return r&&(t.android=!0,t.version=r[2]),i&&(t.ios=!0,t.version=i[2].replace(/_/g,"."),t.ios7=/^7/.test(t.version),"iPad"===i[1]?t.ipad=!0:"iPhone"===i[1]?(t.iphone=!0,t.iphone5=568==screen.height):"iPod"===i[1]&&(t.ipod=!0)),n&&(t.wp=!0,t.version=n[2],t.wp8=/^8/.test(t.version)),a&&(t.webkit=!0),o&&(t.safari=!0),t}();var e={proxyid:0,proxies:[],trigger:function(t,e,r){var i,n={bubbles:!0,cancelable:!0,detail:r=r||{}};try{"undefined"!=typeof CustomEvent?(i=new CustomEvent(e,n),t&&t.dispatchEvent(i)):((i=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,r),t&&t.dispatchEvent(i))}catch(t){console.warn("Touch.js is not supported by environment.")}},bind:function(e,r,i){e.listeners=e.listeners||{},e.listeners[r]?e.listeners[r].push(i):e.listeners[r]=[i];var n=function(e){t.env.ios7&&t.forceReflow(),e.originEvent=e;for(var r in e.detail)"type"!==r&&(e[r]=e.detail[r]);e.startRotate=function(){v=!0};var n=i.call(e.target,e);void 0===n||n||(e.stopPropagation(),e.preventDefault())};i.proxy=i.proxy||{},i.proxy[r]?i.proxy[r].push(this.proxyid++):i.proxy[r]=[this.proxyid++],this.proxies.push(n),e.addEventListener&&e.addEventListener(r,n,!1)},unbind:function(t,e,r){if(r){var i=r.proxy[e];i&&i.length&&i.forEach(function(r){t.removeEventListener&&t.removeEventListener(e,this.proxies[this.proxyid],!1)})}else{var n=t.listeners[e];n&&n.length&&n.forEach(function(r){t.removeEventListener(e,r,!1)})}},delegate:function(e,r,i,n){var a=function(r){var a,o;r.originEvent=r;for(var s in r.detail)"type"!==s&&(r[s]=r.detail[s]);r.startRotate=function(){v=!0};var u=t.getSelector(e)+" "+i,c=t.matchSelector(r.target,u),l=t.matchSelector(r.target,u+" "+r.target.nodeName);if(!c&&l){for(t.env.ios7&&t.forceReflow(),a=r.target;!t.matchSelector(a,u);)a=a.parentNode;void 0===(o=n.call(r.target,r))||o||(r.stopPropagation(),r.preventDefault())}else t.env.ios7&&t.forceReflow(),(c||l)&&(void 0===(o=n.call(r.target,r))||o||(r.stopPropagation(),r.preventDefault()))};n.proxy=n.proxy||{},n.proxy[r]?n.proxy[r].push(this.proxyid++):n.proxy[r]=[this.proxyid++],this.proxies.push(a),e.listeners=e.listeners||{},e.listeners[r]?e.listeners[r].push(a):e.listeners[r]=[a],e.addEventListener&&e.addEventListener(r,a,!1)},undelegate:function(t,e,r,i){if(i){var n=i.proxy[e];n.length&&n.forEach(function(r){t.removeEventListener&&t.removeEventListener(e,this.proxies[this.proxyid],!1)})}else t.listeners[e].forEach(function(r){t.removeEventListener(e,r,!1)})}},r={tap:!0,doubleTap:!0,tapMaxDistance:10,hold:!0,tapTime:200,holdTime:650,maxDoubleTapInterval:300,swipe:!0,swipeTime:300,swipeMinDistance:18,swipeFactor:5,drag:!0,pinch:!0,minScaleRate:0,minRotationAngle:0},i={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",CLICK:"click",PINCH_START:"pinchstart",PINCH_END:"pinchend",PINCH:"pinch",PINCH_IN:"pinchin",PINCH_OUT:"pinchout",ROTATION_LEFT:"rotateleft",ROTATION_RIGHT:"rotateright",ROTATION:"rotate",SWIPE_START:"swipestart",SWIPING:"swiping",SWIPE_END:"swipeend",SWIPE_LEFT:"swipeleft",SWIPE_RIGHT:"swiperight",SWIPE_UP:"swipeup",SWIPE_DOWN:"swipedown",SWIPE:"swipe",DRAG:"drag",DRAGSTART:"dragstart",DRAGEND:"dragend",HOLD:"hold",TAP:"tap",DOUBLE_TAP:"doubletap"},n={start:null,move:null,end:null},a=0,o=null,s=null,u=null,c=!1,l=!1,h=!1,p={},d=!1,f=null,g=!1,m=null,E=1,v=!1,y=[],T=0,A=0,S=0,x=null,_={getAngleDiff:function(e){for(var r=parseInt(T-t.getAngle180(e[0],e[1]),10),i=0;Math.abs(r-A)>90&&i++<50;)A<0?r-=180:r+=180;return A=parseInt(r,10)},pinch:function(a){var o=a.target;if(r.pinch){if(!d)return;if(t.getFingers(a)<2&&!t.isTouchEnd(a))return;var s=t.calScale(n.start,n.move),u=this.getAngleDiff(n.move),c={type:"",originEvent:a,scale:s,rotation:u,direction:u>0?"right":"left",fingersCount:t.getFingers(a)};if(l?t.isTouchMove(a)?(c.fingerStatus="move",e.trigger(o,i.PINCH,c)):t.isTouchEnd(a)&&(c.fingerStatus="end",e.trigger(o,i.PINCH_END,c),t.reset()):(l=!0,c.fingerStatus="start",e.trigger(o,i.PINCH_START,c)),Math.abs(1-s)>r.minScaleRate){var h=t.simpleClone(c);s>E?(E=s-1e-11,e.trigger(o,i.PINCH_OUT,h,!1)):s<E&&(E=s+1e-11,e.trigger(o,i.PINCH_IN,h,!1)),t.isTouchEnd(a)&&(E=1)}if(Math.abs(u)>r.minRotationAngle){var p,f=t.simpleClone(c);p=u>0?i.ROTATION_RIGHT:i.ROTATION_LEFT,e.trigger(o,p,f,!1),e.trigger(o,i.ROTATION,c)}}},rotateSingleFinger:function(r){var a=r.target;if(v&&t.getFingers(r)<2){if(!n.move)return;if(y.length<2){var o=t.getXYByElement(a);y=[{x:o.left+a.offsetWidth/2,y:o.top+a.offsetHeight/2},n.move[0]],T=parseInt(t.getAngle180(y[0],y[1]),10)}var s=[y[0],n.move[0]],u=this.getAngleDiff(s),c={type:"",originEvent:r,rotation:u,direction:u>0?"right":"left",fingersCount:t.getFingers(r)};t.isTouchMove(r)?c.fingerStatus="move":(t.isTouchEnd(r)||"mouseout"===r.type)&&(c.fingerStatus="end",e.trigger(a,i.PINCH_END,c),t.reset());var l=u>0?i.ROTATION_RIGHT:i.ROTATION_LEFT;e.trigger(a,l,c),e.trigger(a,i.ROTATION,c)}},swipe:function(o){var s=o.target;if(d&&n.move&&!(t.getFingers(o)>1)){var u=Date.now()-a,l=t.getDistance(n.start[0],n.move[0]),f={x:n.move[0].x-p.left,y:n.move[0].y-p.top},g=t.getAngle(n.start[0],n.move[0]),m=t.getDirectionFromAngle(g),E=u/1e3,v=10*(10-r.swipeFactor)*E*E,y={type:i.SWIPE,originEvent:o,position:f,direction:m,distance:l,distanceX:n.move[0].x-n.start[0].x,distanceY:n.move[0].y-n.start[0].y,x:n.move[0].x-n.start[0].x,y:n.move[0].y-n.start[0].y,angle:g,duration:u,fingersCount:t.getFingers(o),factor:v};if(r.swipe){var T=function(){var t=i;switch(m){case"up":e.trigger(s,t.SWIPE_UP,y);break;case"down":e.trigger(s,t.SWIPE_DOWN,y);break;case"left":e.trigger(s,t.SWIPE_LEFT,y);break;case"right":e.trigger(s,t.SWIPE_RIGHT,y)}};c?t.isTouchMove(o)?(y.fingerStatus=y.swipe="move",e.trigger(s,i.SWIPING,y),u>r.swipeTime&&u<r.swipeTime+50&&l>r.swipeMinDistance&&(T(),e.trigger(s,i.SWIPE,y,!1))):(t.isTouchEnd(o)||"mouseout"===o.type)&&(y.fingerStatus=y.swipe="end",e.trigger(s,i.SWIPE_END,y),r.swipeTime>u&&l>r.swipeMinDistance&&(T(),e.trigger(s,i.SWIPE,y,!1))):(y.fingerStatus=y.swipe="start",c=!0,e.trigger(s,i.SWIPE_START,y))}r.drag&&(h?t.isTouchMove(o)?(y.fingerStatus=y.swipe="move",e.trigger(s,i.DRAG,y)):t.isTouchEnd(o)&&(y.fingerStatus=y.swipe="end",e.trigger(s,i.DRAGEND,y)):(y.fingerStatus=y.swipe="start",h=!0,e.trigger(s,i.DRAGSTART,y)))}},tap:function(o){var s=o.target;if(r.tap){var u=Date.now(),c=u-a,l=t.getDistance(n.start[0],n.move?n.move[0]:n.start[0]);if(clearTimeout(f),!!(x&&r.doubleTap&&a-S<r.maxDoubleTapInterval&&t.getDistance(x,n.start[0])<16))return clearTimeout(m),void e.trigger(s,i.DOUBLE_TAP,{type:i.DOUBLE_TAP,originEvent:o,position:n.start[0]});if(r.tapMaxDistance<l)return;r.holdTime>c&&t.getFingers(o)<=1&&(g=!0,S=u,x=n.start[0],m=setTimeout(function(){e.trigger(s,i.TAP,{type:i.TAP,originEvent:o,fingersCount:t.getFingers(o),position:x})},r.tapTime))}},hold:function(i){var a=i.target;r.hold&&(clearTimeout(f),f=setTimeout(function(){if(n.start){var o=t.getDistance(n.start[0],n.move?n.move[0]:n.start[0]);r.tapMaxDistance<o||g||e.trigger(a,"hold",{type:"hold",originEvent:i,fingersCount:t.getFingers(i),position:n.start[0]})}},r.holdTime))}},b=function(e){var r=e.target;switch(e.type){case"touchstart":case"mousedown":y=[],d=!0,(!n.start||n.start.length<2)&&(n.start=t.getPosOfEvent(e)),t.getFingers(e)>=2&&(T=parseInt(t.getAngle180(n.start[0],n.start[1]),10)),a=Date.now(),o=e,p={};var i=r.getBoundingClientRect(),s=document.documentElement;p={top:i.top+(window.pageYOffset||s.scrollTop)-(s.clientTop||0),left:i.left+(window.pageXOffset||s.scrollLeft)-(s.clientLeft||0)},_.hold(e);break;case"touchmove":case"mousemove":if(!d||!n.start)return;n.move=t.getPosOfEvent(e),t.getFingers(e)>=2?_.pinch(e):v?_.rotateSingleFinger(e):_.swipe(e);break;case"touchend":case"touchcancel":case"mouseup":case"mouseout":if(!d)return;u=e,l?_.pinch(e):v?_.rotateSingleFinger(e):c?_.swipe(e):_.tap(e),t.reset(),T=0,A=0,e.touches&&1===e.touches.length&&(d=!0,v=!0)}};(t.hasTouch?"touchstart touchmove touchend touchcancel":"mouseup mousedown mousemove mouseout").split(" ").forEach(function(t){document.addEventListener(t,b,!1)});var P={};return P.on=P.bind=P.live=function(){var r,i,n,a,o=arguments;if(o.length<2||o>4)return console.error("unexpected arguments!");var s="string"===t.getType(o[0])?document.querySelectorAll(o[0]):o[0];if(s=s.length?Array.prototype.slice.call(s):[s],3===o.length&&"string"===t.getType(o[1]))return r=o[1].split(" "),i=o[2],void r.forEach(function(r){t.hasTouch||(r=t.getPCevts(r)),s.forEach(function(t){e.bind(t,r,i)})});if(3!==o.length||"object"!==t.getType(o[1]))if(2!==o.length||"object"!==t.getType(o[1])){if(4===o.length&&"object"===t.getType(o[2]))return r=o[1].split(" "),i=o[3],void r.forEach(function(r){t.hasTouch||(r=t.getPCevts(r)),s.forEach(function(t){e.bind(t,r,i)})});if(4===o.length){var u=s[0];return r=o[1].split(" "),a=o[2],i=o[3],void r.forEach(function(r){t.hasTouch||(r=t.getPCevts(r)),e.delegate(u,r,a,i)})}}else{n=o[1];for(var c in n)!function(r){t.hasTouch||(r=t.getPCevts(r)),s.forEach(function(t){e.bind(t,r,n[r])})}(c)}else{n=o[1],a=o[2];for(var l in n)!function(r){t.hasTouch||(r=t.getPCevts(r)),s.forEach(function(t){e.delegate(t,r,a,n[r])})}(l)}},P.off=P.unbind=P.die=function(){var r,i,n=arguments;if(n.length<1||n.length>4)return console.error("unexpected arguments!");var a="string"===t.getType(n[0])?document.querySelectorAll(n[0]):n[0];if(a=a.length?Array.prototype.slice.call(a):[a],1!==n.length&&2!==n.length){if(3===n.length&&"function"===t.getType(n[2]))return i=n[2],void a.forEach(function(a){(r=n[1].split(" ")).forEach(function(r){t.hasTouch||(r=t.getPCevts(r)),e.unbind(a,r,i)})});if(3!==n.length||"string"!==t.getType(n[2]))return 4===n.length?(i=n[3],void a.forEach(function(a){(r=n[1].split(" ")).forEach(function(r){t.hasTouch||(r=t.getPCevts(r)),e.undelegate(a,r,o,i)})})):void 0;var o=n[2];a.forEach(function(i){(r=n[1].split(" ")).forEach(function(r){t.hasTouch||(r=t.getPCevts(r)),e.undelegate(i,r,o)})})}else a.forEach(function(i){(r=n[1]?n[1].split(" "):Object.keys(i.listeners)).length&&r.forEach(function(r){t.hasTouch||(r=t.getPCevts(r)),e.unbind(i,r),e.undelegate(i,r)})})},P.config=r,P.trigger=function(r,i,n){var a=arguments;t.hasTouch||(i=t.getPCevts(i));var o="string"===t.getType(a[0])?document.querySelectorAll(a[0]):a[0];(o=o.length?Array.prototype.call(o):[o]).forEach(function(t){e.trigger(t,i,n)})},P});var TWEEN=TWEEN||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)},update:function(e,r){if(0===t.length)return!1;var i=0;for(e=void 0!==e?e:TWEEN.now();i<t.length;)t[i].update(e)||r?i++:t.splice(i,1);return!0}}}();(function(){void 0===this.window&&void 0!==this.process?TWEEN.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e3}:void 0!==this.window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()}}).bind(this)(),TWEEN.Tween=function(t){var e,r=t,i={},n={},a={},o=1e3,s=0,u=!1,c=!1,l=!1,h=0,p=null,d=TWEEN.Easing.Linear.None,f=TWEEN.Interpolation.Linear,g=[],m=null,E=!1,v=null,y=null,T=null;for(var A in t)i[A]=parseFloat(t[A],10);this.to=function(t,e){return void 0!==e&&(o=e),n=t,this},this.start=function(t){TWEEN.add(this),c=!0,E=!1,p=void 0!==t?t:TWEEN.now(),p+=h;for(var e in n){if(n[e]instanceof Array){if(0===n[e].length)continue;n[e]=[r[e]].concat(n[e])}void 0!==i[e]&&(i[e]=r[e],i[e]instanceof Array==!1&&(i[e]*=1),a[e]=i[e]||0)}return this},this.stop=function(){return c?(TWEEN.remove(this),c=!1,null!==T&&T.call(r),this.stopChainedTweens(),this):this},this.end=function(){return this.update(p+o),this},this.stopChainedTweens=function(){for(var t=0,e=g.length;t<e;t++)g[t].stop()},this.delay=function(t){return h=t,this},this.repeat=function(t){return s=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return u=t,this},this.easing=function(t){return d=t,this},this.interpolation=function(t){return f=t,this},this.chain=function(){return g=arguments,this},this.onStart=function(t){return m=t,this},this.onUpdate=function(t){return v=t,this},this.onComplete=function(t){return y=t,this},this.onStop=function(t){return T=t,this},this.update=function(t){var c,T,A;if(t<p)return!0;!1===E&&(null!==m&&m.call(r),E=!0),A=d(T=(T=(t-p)/o)>1?1:T);for(c in n)if(void 0!==i[c]){var S=i[c]||0,x=n[c];x instanceof Array?r[c]=f(x,A):("string"==typeof x&&(x="+"===x.charAt(0)||"-"===x.charAt(0)?S+parseFloat(x,10):parseFloat(x,10)),"number"==typeof x&&(r[c]=S+(x-S)*A))}if(null!==v&&v.call(r,A),1===T){if(s>0){isFinite(s)&&s--;for(c in a){if("string"==typeof n[c]&&(a[c]=a[c]+parseFloat(n[c],10)),u){var _=a[c];a[c]=n[c],n[c]=_}i[c]=a[c]}return u&&(l=!l),p=void 0!==e?t+e:t+h,!0}null!==y&&y.call(r);for(var b=0,P=g.length;b<P;b++)g[b].start(p+o);return!1}return!0}},TWEEN.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},TWEEN.Interpolation={Linear:function(t,e){var r=t.length-1,i=r*e,n=Math.floor(i),a=TWEEN.Interpolation.Utils.Linear;return e<0?a(t[0],t[1],i):e>1?a(t[r],t[r-1],r-i):a(t[n],t[n+1>r?r:n+1],i-n)},Bezier:function(t,e){for(var r=0,i=t.length-1,n=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein,o=0;o<=i;o++)r+=n(1-e,i-o)*n(e,o)*t[o]*a(i,o);return r},CatmullRom:function(t,e){var r=t.length-1,i=r*e,n=Math.floor(i),a=TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[r]?(e<0&&(n=Math.floor(i=r*(1+e))),a(t[(n-1+r)%r],t[n],t[(n+1)%r],t[(n+2)%r],i-n)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[r]-(a(t[r],t[r],t[r-1],t[r-1],i-r)-t[r]):a(t[n?n-1:0],t[n],t[r<n+1?r:n+1],t[r<n+2?r:n+2],i-n)},Utils:{Linear:function(t,e,r){return(e-t)*r+t},Bernstein:function(t,e){var r=TWEEN.Interpolation.Utils.Factorial;return r(t)/r(e)/r(t-e)},Factorial:function(){var t=[1];return function(e){var r=1;if(t[e])return t[e];for(var i=e;i>1;i--)r*=i;return t[e]=r,r}}(),CatmullRom:function(t,e,r,i,n){var a=.5*(r-t),o=.5*(i-e),s=n*n;return(2*e-2*r+a+o)*(n*s)+(-3*e+3*r-2*a-o)*s+a*n+e}}},function(t){"function"==typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==t&&(t.TWEEN=TWEEN)}(this);